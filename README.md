# metaLogger

The metaLogger project is for adding logging instances to remote machines with the intention of logging data to the meta Logger service on `theAxeRant.com`

## New Logging Deployments

### Requirements
* php >= 7.2

### Install the phar file

The phar file can be downloaded from the [releases][1] section of the project.  The phar file can be copied to the 
intended server and run from there. 

```bash
wget https://github.com/theAxeRant/metaLogger/blob/main/devops/release/metaLogger.phar
```

### Create the config file

An api auth_key needs to be generated on theAxeRant.com server for the intended user who is doing the logging.

An empty configuration file can be generated by running 
```shell
php metaLogger.phar config:create --config=<filename>
```

### loggers

The metaLogger has several loggers capable of reporting different things to the meta logger service.

#### ip check

The ip check will get the internal IP of the server.  The output of `ifconfig` has changed through the years, therefor there are serveral parser versions, the current being version `3` which should be used for the initial tests.  The netmask of the expected network should be used to remove any other network interfaces that may be returned by `ifconfig`

#### drive

The `drive` key can contain a collection of named paths.  The paths are passed to the php `disk_free_space()` function, this will report the free space on the coorepsonding filesystem or disk partition.  This value will be reported in MB with the probided name as the key.

```yaml
file_access:
    - {name: "", path: "" }
```

#### file_access

The `file_access` key can contain a collection of named paths.  The paths should be to individual files, but directories are acceptable as well.  The script will report the last file access time of the path provided with the name as a key.

```yaml
file_access:
    - {name: "", path: "" }
```

#### file_count

The `file_count` key can contain a collection of named paths.  The paths are used to `glob` a filecount and report that count using the name as a key.

```yaml
file_count:
    - {name: "", path: "" }
```

### Setup the crontab job

Full paths should be used when creating cronjobs, this is an example of a metaLogger implementation on a raspberry pi.  Note the full path for the php command, metaLogger.phar and the configuration file to be used.

```crontab
*/5 * * * * /usr/bin/php /home/pi/services/metaLogger/metaLogger.phar config:run /home/pi/services/metaLogger/config.yaml
```

## Development of metaLogger
The metaLogger.phar is built using a virtual machine instance.

---
<dl>
    <dt>
        <em>Based of the <a href="https://github.com/ryanwhowe/symfony-template">symfony-template</a> GitHub Template project</em>
    </dt>
    <dd>
        <strong>by <a href="https://github.com/ryanwhowe" target="_blank">Ryan Howe</a></strong>
    </dd>
</dl>

[1]: https://github.com/theAxeRant/metaLogger/blob/main/devops/release/metaLogger.phar